# Research Report: Git Operations & GitHub API for Automated PR Workflows

**Date**: 2025-11-21
**Researcher**: Claude Code
**Topic**: Git libraries, GitHub API integration, automated PR workflows, authentication strategies

---

## 1. Git Operations in Node.js

### 1.1 Library Comparison: simple-git vs isomorphic-git

| Feature | simple-git | isomorphic-git |
|---------|-----------|----------------|
| **Implementation** | Wrapper around Git CLI | Pure JavaScript implementation |
| **Weekly Downloads** | 5,993,819 | 535,969 |
| **GitHub Stars** | 3,714 | 7,839 |
| **Environment** | Node.js only (server-side) | Node.js + Browser (isomorphic) |
| **Git Dependency** | Requires Git CLI installed | No Git installation needed |
| **API Complexity** | Simple, straightforward | More complex, steeper learning curve |
| **Performance** | Fast for most operations | May lag on large repositories |
| **Use Case** | Quick integrations, server-side automation | Browser apps, serverless, client-side Git |

**Recommendation**: Use **simple-git** for E2B sandbox workflows (server-side automation, Git CLI available).

### 1.2 simple-git Code Examples

**Installation:**
```bash
npm install simple-git
```

**Clone with authentication:**
```javascript
const simpleGit = require('simple-git');
const USER = 'username';
const TOKEN = 'ghp_personalAccessToken123';
const REPO = 'github.com/owner/repo';

const remote = `https://${USER}:${TOKEN}@${REPO}`;
const git = simpleGit();

await git.clone(remote, './repo-path');
```

**Branch, commit, push workflow:**
```javascript
const git = simpleGit('./repo-path');

// Create and checkout branch
await git.checkoutLocalBranch('feature/automated-changes');

// Stage files
await git.add('./*');

// Commit with conventional commits format
await git.commit('feat: add automated workflow changes');

// Push to remote
await git.push('origin', 'feature/automated-changes');
```

**Authentication via HTTP headers (recommended for PATs):**
```javascript
const git = simpleGit({
  config: [
    `http.extraHeader=Authorization: Bearer ${process.env.GITHUB_TOKEN}`
  ]
});
```

**Sources:**
- https://www.npmjs.com/package/simple-git
- https://stackoverflow.com/questions/66515706/how-to-commit-and-push-with-simple-git-nodejs
- https://stackoverflow.com/questions/67904939/node-js-clone-git-repository-using-a-personal-access-token-and-simple-git

---

## 2. GitHub API: REST & GraphQL

### 2.1 Authentication Methods

**Three authentication types (2025):**
1. **Fine-grained Personal Access Tokens (PATs)** - User-generated, specific scopes
2. **GitHub App installation access tokens** - Installation-level access
3. **GitHub App user access tokens** - App-authenticated on behalf of users

### 2.2 Pull Request Endpoints

**Create PR:**
```
POST /repos/{owner}/{repo}/pulls
```

**Required permissions:** `Pull requests: write`

**Example with Octokit:**
```javascript
import { Octokit } from "@octokit/core";

const octokit = new Octokit({
  auth: process.env.GITHUB_TOKEN
});

const response = await octokit.request('POST /repos/{owner}/{repo}/pulls', {
  owner: 'organization-name',
  repo: 'repository-name',
  title: 'feat: automated workflow improvements',
  body: 'Automated changes generated by E2B sandbox agent',
  head: 'feature/automated-changes',
  base: 'main'
});

console.log(`PR created: ${response.data.html_url}`);
```

**Other PR operations:**
- `GET /repos/{owner}/{repo}/pulls` - List PRs
- `GET /repos/{owner}/{repo}/pulls/{pull_number}` - Get specific PR
- `PATCH /repos/{owner}/{repo}/pulls/{pull_number}` - Update PR

**Response codes:**
- 201: PR created successfully
- 422: Validation failed (branch already has PR, invalid base/head)
- 403: Forbidden (insufficient permissions)
- 404: Repository not found

**Sources:**
- https://docs.github.com/en/rest/pulls/pulls
- https://www.pluralsight.com/resources/blog/guides/open-a-pull-request-via-the-github-api
- https://github.com/octokit/core.js/

---

## 3. Automated Workflows Best Practices

### 3.1 Conventional Commits Specification

**Format:** `<type>[optional scope]: <description>`

**Core types:**
- `feat:` - New feature (MINOR version bump)
- `fix:` - Bug fix (PATCH version bump)
- `docs:` - Documentation changes
- `chore:` - Maintenance tasks
- `refactor:` - Code restructuring
- `test:` - Test additions/modifications
- `ci:` - CI/CD changes

**Breaking changes:** Append `!` or add `BREAKING CHANGE:` footer (MAJOR version bump)

**Examples for bot commits:**
```
feat: add automated code review integration
fix: correct branch naming in workflow
chore(deps): update dependencies via automated scan
docs: auto-generate API documentation
```

**Automation benefits:**
- Semantic version bumps automatically determined
- CHANGELOG.md auto-generated
- Release notes automation (semantic-release)
- PR labeling based on commit type

**Sources:**
- https://www.conventionalcommits.org/en/v1.0.0/
- https://dev.to/tene/mastering-conventional-commits-structure-benefits-and-tools-3cpo
- https://www.averagedevs.com/blog/conventional-commits-git

### 3.2 PR Template Example

```markdown
## Summary
Automated changes generated by E2B sandbox agent.

## Changes
- [x] Updated dependencies
- [x] Fixed linting issues
- [x] Regenerated documentation

## Test Plan
- Automated tests passed in sandbox environment
- Manual review recommended for critical paths

## Checklist
- [x] Conventional commits followed
- [x] Tests passing
- [x] Documentation updated

---
*Generated by: E2B Sandbox Agent*
*Timestamp: {{ timestamp }}*
```

---

## 4. Security: Token Management & Credential Storage

### 4.1 Best Practices

**Token storage in sandboxes:**
- Use environment variables (`process.env.GITHUB_TOKEN`)
- Never hardcode tokens in code
- Use secrets management (E2B supports env vars in sandbox config)
- Rotate tokens regularly

**Authentication hierarchy (most to least secure):**
1. GitHub Apps with installation tokens (short-lived, auto-expire)
2. Fine-grained PATs (specific permissions, repo-scoped)
3. Classic PATs (broad permissions, deprecated after Dec 9, 2025)

**SSH vs HTTPS:**
- HTTPS recommended for automation (easier token management)
- SSH requires key management in sandbox (more complex)

### 4.2 Credential Storage Examples

**simple-git with environment token:**
```javascript
const git = simpleGit({
  config: [
    `http.extraHeader=Authorization: Bearer ${process.env.GITHUB_TOKEN}`
  ]
});
```

**Octokit with environment token:**
```javascript
const octokit = new Octokit({
  auth: process.env.GITHUB_TOKEN
});
```

**Sources:**
- https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens
- https://github.com/octokit/auth-token.js/

---

## 5. GitHub Apps vs Personal Access Tokens

### 5.1 Detailed Comparison

| Aspect | GitHub Apps | Personal Access Tokens |
|--------|-------------|------------------------|
| **Rate Limits** | 15,000 req/hr per installation (scales with repos/users) | 5,000 req/hr per user (fixed) |
| **Identity** | Independent app identity | Tied to user account |
| **Token Lifetime** | Short-lived (1 hour max) | Long-lived (until revoked) |
| **Permissions** | Fine-grained, repo-specific | Broad or fine-grained (classic vs fine-grained) |
| **Webhooks** | Built-in webhook support | Not available |
| **Enterprise Benefits** | Included in higher rate limits | Excluded from enterprise limit increases |
| **Audit Trail** | Clear app attribution | Appears as user action |
| **Complexity** | More complex setup (app registration, private keys) | Simple token generation |

### 5.2 When to Use Each

**Use GitHub Apps when:**
- Building production automation systems
- Need higher rate limits (>5k/hr)
- Want clear audit trails (bot identity)
- Require webhook integrations
- Operating at organization scale

**Use Personal Access Tokens when:**
- Quick prototyping or scripts
- Personal automation workflows
- Simple CI/CD pipelines
- Single-user scenarios
- Lower request volume (<5k/hr)

**2025 Migration Note:** Classic PATs deprecated, migrate to fine-grained PATs or GitHub Apps.

**Sources:**
- https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/differences-between-github-apps-and-oauth-apps
- https://bmterra.eu/articles/010625-using-github-apps/
- https://docs.github.com/en/apps/creating-github-apps/about-creating-github-apps/best-practices-for-creating-a-github-app

---

## 6. Complete Workflow Example

```javascript
import simpleGit from 'simple-git';
import { Octokit } from '@octokit/core';

async function automatedPRWorkflow(repoUrl, changes, prDetails) {
  const TOKEN = process.env.GITHUB_TOKEN;
  const git = simpleGit();
  const octokit = new Octokit({ auth: TOKEN });

  // 1. Clone repository
  const remote = repoUrl.replace('https://', `https://x-access-token:${TOKEN}@`);
  await git.clone(remote, './workspace');

  // 2. Navigate to repo
  const repoGit = simpleGit('./workspace');

  // 3. Create feature branch
  const branchName = `automated/${Date.now()}`;
  await repoGit.checkoutLocalBranch(branchName);

  // 4. Make changes (simulated)
  // ... file modifications here ...

  // 5. Stage and commit
  await repoGit.add('./*');
  await repoGit.commit('feat: automated workflow improvements');

  // 6. Push branch
  await repoGit.push('origin', branchName, ['--set-upstream']);

  // 7. Create pull request
  const [owner, repo] = repoUrl.split('/').slice(-2);
  const pr = await octokit.request('POST /repos/{owner}/{repo}/pulls', {
    owner,
    repo: repo.replace('.git', ''),
    title: prDetails.title,
    body: prDetails.body,
    head: branchName,
    base: 'main'
  });

  return pr.data.html_url;
}
```

---

## Unresolved Questions

None. Research complete with actionable implementation patterns.

---

**Report compiled from 10 authoritative sources.**
